<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Rule of 100</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<style>
[data-theme="dark"]{--bg:#080808;--s:#101010;--s2:#131313;--s3:#0c0c0c;--b:#1c1c1c;--b2:#252525;--b3:#2a2a2a;--t:#efefef;--t2:#888;--t3:#555;--dim:#383838;--dr:#2a2a2a;--dmt:#1e1e1e;--ac:#e8ff47;--ag:rgba(232,255,71,0.18);--ns:0.5}
[data-theme="light"]{--bg:#f4f4f0;--s:#fff;--s2:#f8f8f5;--s3:#f0f0ec;--b:#e0e0da;--b2:#d0d0ca;--b3:#c0c0ba;--t:#111;--t2:#555;--t3:#888;--dim:#666;--dr:#999;--dmt:#aaa;--ac:#1a1a1a;--ag:rgba(0,0,0,0.06);--ns:0.2}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}html{-webkit-tap-highlight-color:transparent}
body{background:var(--bg);color:var(--t);font-family:'DM Sans',sans-serif;min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased;transition:background .3s,color .3s}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;opacity:var(--ns);transition:opacity .3s}
input[type=number]{-moz-appearance:textfield}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--b3);border-radius:2px}
textarea,select{-webkit-appearance:none;appearance:none}textarea::placeholder,input::placeholder{color:var(--dr)}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
@keyframes scaleIn{from{transform:scale(.85);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes slideInR{from{transform:translateX(110%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes slideOutR{from{transform:translateX(0);opacity:1}to{transform:translateX(110%);opacity:0}}
@keyframes pulseGlow{0%,100%{box-shadow:0 0 0 0 transparent}50%{box-shadow:0 0 32px 6px var(--ag)}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
@keyframes drop{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.fu{animation:fadeUp .4s ease both}.si{animation:scaleIn .3s cubic-bezier(.34,1.56,.64,1) both}
.pg{animation:pulseGlow 2.5s ease-in-out infinite}.bl{animation:blink 1.4s ease-in-out infinite}
.card{background:var(--s);border:1px solid var(--b);border-radius:12px;padding:18px;transition:background .3s,border-color .3s}
.slbl{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2.5px;text-transform:uppercase;color:var(--dr);margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--b);display:flex;align-items:center;justify-content:space-between;transition:color .3s,border-color .3s}
.msm{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:1px}
.bbs{font-family:'Bebas Neue',sans-serif}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
.g4{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.ghl{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.plcol{min-height:160px;border-radius:10px;padding:8px;background:var(--s3);border:1px solid var(--b);transition:background .3s,border-color .3s}
.plcol.dov{border-color:var(--ac)!important;background:var(--s2)}
.pc{background:var(--s);border:1px solid var(--b);border-left-width:3px;border-radius:8px;padding:10px 12px;margin-bottom:7px;cursor:grab;animation:drop .2s ease both;transition:border-color .15s,transform .15s}
.pc:hover{border-color:var(--b3);transform:translateY(-1px)}.pc.dragging{opacity:.35;transform:scale(.97)}
.addbtn{width:100%;padding:7px;border-radius:6px;border:1px dashed var(--b2);background:transparent;color:var(--dr);cursor:pointer;font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;transition:all .15s;margin-top:2px}
.addbtn:hover{border-color:var(--b3);color:var(--dim)}
.gbtn{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;background:transparent;border:1px solid var(--b);color:var(--dim);padding:5px 10px;border-radius:4px;cursor:pointer;transition:all .15s}
#shareOverlay{display:none;position:fixed;inset:0;z-index:400;background:rgba(0,0,0,.92);backdrop-filter:blur(16px);align-items:center;justify-content:center;padding:20px}
@media(max-width:640px){
  .g2,.g3,.ghl{grid-template-columns:1fr}.g4{grid-template-columns:repeat(2,1fr)}
  .hi{flex-direction:column!important;align-items:flex-start!important;gap:16px!important}.hr{align-self:center}
  .hm{display:none!important}.gb{display:none!important}
  main{padding:14px 12px 80px!important}
}
</style>
</head>
<body>
<header style="position:sticky;top:0;z-index:100;background:var(--bg);backdrop-filter:blur(16px);border-bottom:1px solid var(--b);padding:11px 18px;display:flex;align-items:center;justify-content:space-between;transition:background .3s,border-color .3s;">
  <div>
    <div class="bbs" style="font-size:24px;letter-spacing:4px;color:var(--ac);line-height:1;transition:color .3s;">RULE OF 100</div>
    <div class="msm" style="color:var(--dr);margin-top:1px;letter-spacing:2.5px;font-size:8px;">DAILY ACCOUNTABILITY</div>
  </div>
  <div style="display:flex;align-items:center;gap:8px;">
    <button onclick="openShare()" style="width:36px;height:36px;border-radius:8px;border:1px solid var(--b);background:var(--s);color:var(--t2);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all .2s;" title="Share today">ğŸ“¤</button>
    <button id="themeBtn" onclick="toggleTheme()" style="width:36px;height:36px;border-radius:8px;border:1px solid var(--b);background:var(--s);color:var(--t2);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all .2s;">ğŸŒ™</button>
    <div id="streakBadge" style="font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:2px;color:var(--dr);border:1px solid var(--b);padding:5px 11px;border-radius:6px;transition:all .3s;white-space:nowrap;">0 <span class="msm" style="font-size:8px;color:var(--t3);">DAY</span></div>
    <div id="dateBadge" class="msm hm" style="color:var(--dim);padding:5px 10px;border:1px solid var(--b);border-radius:6px;font-size:9px;"></div>
  </div>
</header>

<main style="max-width:960px;margin:0 auto;padding:18px 16px 80px;">

<!-- HERO -->
<div id="hero" class="fu card" style="margin-bottom:16px;animation-delay:.05s;">
  <div class="hi" style="display:flex;align-items:center;gap:22px;">
    <div class="hr" style="position:relative;width:140px;height:140px;flex-shrink:0;">
      <svg width="140" height="140" viewBox="0 0 140 140" style="transform:rotate(-90deg);display:block;">
        <circle cx="70" cy="70" r="60" fill="none" stroke="var(--b)" stroke-width="9"/>
        <circle id="rGlow" cx="70" cy="70" r="60" fill="none" stroke="#e8ff47" stroke-width="15" stroke-dasharray="376.99" stroke-dashoffset="376.99" stroke-linecap="round" opacity=".12" style="transition:stroke-dashoffset .7s cubic-bezier(.34,1.56,.64,1),stroke .3s;"/>
        <circle id="rArc"  cx="70" cy="70" r="60" fill="none" stroke="#e8ff47" stroke-width="9"  stroke-dasharray="376.99" stroke-dashoffset="376.99" stroke-linecap="round" style="transition:stroke-dashoffset .7s cubic-bezier(.34,1.56,.64,1),stroke .3s;"/>
      </svg>
      <div style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;">
        <div id="bigNum" class="bbs" style="font-size:44px;line-height:1;color:var(--t);letter-spacing:1px;transition:color .3s;">0</div>
        <div class="msm" style="color:var(--dim);letter-spacing:2px;margin-top:3px;font-size:8px;">/ 100</div>
      </div>
    </div>
    <div style="flex:1;min-width:0;">
      <div id="headline" class="bbs" style="font-size:26px;letter-spacing:2px;line-height:1.1;color:var(--t);margin-bottom:7px;transition:color .3s;">SHOW UP. DO THE WORK.</div>
      <div id="subline" style="font-size:13px;color:var(--t3);line-height:1.6;margin-bottom:14px;">Pick a method. Log 100 total actions today. Any mix. No excuses.</div>
      <div style="display:flex;gap:18px;">
        <div style="text-align:center;"><div id="statRemain" class="bbs" style="font-size:24px;line-height:1;color:var(--t3);letter-spacing:1px;transition:color .3s;">100</div><div class="msm" style="color:var(--dim);margin-top:3px;font-size:8px;">LEFT</div></div>
        <div style="text-align:center;"><div id="statXP" class="bbs" style="font-size:24px;line-height:1;color:#e8ff47;letter-spacing:1px;">+0</div><div class="msm" style="color:var(--dim);margin-top:3px;font-size:8px;">XP</div></div>
        <div style="text-align:center;"><div id="statGrade" class="bbs" style="font-size:24px;line-height:1;color:var(--t3);letter-spacing:1px;transition:color .3s;">F</div><div class="msm" style="color:var(--dim);margin-top:3px;font-size:8px;">GRADE</div></div>
      </div>
    </div>
    <div id="gBox" class="gb" style="width:68px;height:68px;border-radius:10px;background:var(--s2);border:2px solid var(--b);display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;transition:all .3s;">
      <div id="gLetter" class="bbs" style="font-size:38px;line-height:1;color:var(--dim);transition:color .3s;">F</div>
      <div class="msm" style="color:var(--dr);letter-spacing:1px;margin-top:2px;font-size:8px;">GRADE</div>
    </div>
  </div>
</div>

<!-- MINI CARDS -->
<div id="miniCards" class="g4" style="margin-bottom:16px;"></div>

<!-- METHODS -->
<div class="slbl">LOG YOUR ACTIONS
  <button onclick="confirmReset()" class="gbtn" onmouseenter="this.style.color='#ef4444';this.style.borderColor='rgba(239,68,68,.3)'" onmouseleave="this.style.color='';this.style.borderColor=''">&#8635; RESET</button>
</div>
<div id="methodGrid" class="g2" style="margin-bottom:24px;"></div>

<!-- PIPELINE -->
<div class="slbl">LEAD PIPELINE
  <div style="display:flex;gap:8px;">
    <button onclick="showAddStage()" class="gbtn" onmouseenter="this.style.color='#a855f7';this.style.borderColor='rgba(168,85,247,.3)'" onmouseleave="this.style.color='';this.style.borderColor=''">&#43; STAGE</button>
    <button onclick="showAddProspect(null)" class="gbtn" onmouseenter="this.style.color='#10b981';this.style.borderColor='rgba(16,185,129,.3)'" onmouseleave="this.style.color='';this.style.borderColor=''">&#43; PROSPECT</button>
  </div>
</div>
<div id="pipeSummary" style="display:flex;gap:10px;margin-bottom:14px;flex-wrap:wrap;"></div>
<div id="sourceBreak" style="margin-bottom:14px;"></div>
<div style="overflow-x:auto;padding-bottom:8px;">
  <div id="pipeGrid" style="display:grid;gap:12px;margin-bottom:28px;min-width:600px;"></div>
</div>

<!-- HISTORY + XP -->
<div class="ghl" style="margin-bottom:24px;">
  <div class="card"><div class="slbl">28-DAY HISTORY</div><div id="histGrid"></div></div>
  <div style="display:flex;flex-direction:column;gap:14px;">
    <div class="card">
      <div class="slbl">LEVEL PROGRESS</div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
        <div id="lvlLabel" class="bbs" style="font-size:20px;letter-spacing:2px;color:var(--t3);">LV.1 ROOKIE</div>
        <div id="xpLabel" class="msm" style="color:var(--dim);">0 XP</div>
      </div>
      <div style="height:5px;background:var(--s3);border-radius:3px;overflow:hidden;margin-bottom:14px;">
        <div id="xpBar" style="height:100%;width:0%;border-radius:3px;transition:width .7s cubic-bezier(.34,1.56,.64,1),background .3s;"></div>
      </div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;text-align:center;">
        <div><div id="stDays" class="bbs" style="font-size:22px;">0</div><div class="msm" style="color:var(--dim);margin-top:3px;font-size:8px;">DAYS</div></div>
        <div><div id="stBest" class="bbs" style="font-size:22px;">0</div><div class="msm" style="color:var(--dim);margin-top:3px;font-size:8px;">BEST</div></div>
        <div><div id="stXP"   class="bbs" style="font-size:22px;">0</div><div class="msm" style="color:var(--dim);margin-top:3px;font-size:8px;">TOTAL XP</div></div>
      </div>
    </div>
    <div class="card" style="flex:1;">
      <div class="slbl">STREAK BADGES</div>
      <div id="milestones" style="display:flex;gap:7px;flex-wrap:wrap;"></div>
    </div>
  </div>
</div>

<!-- WEEKLY -->
<div class="slbl">WEEKLY SUMMARY</div>
<div class="card" style="margin-bottom:24px;"><div id="weeklySummary"></div></div>

<!-- DEBRIEF -->
<div class="slbl">DAILY DEBRIEF <span id="debSaved" class="msm" style="color:var(--dr);transition:color .4s;"></span></div>
<div class="g3" style="margin-bottom:14px;">
  <div class="card" style="display:flex;flex-direction:column;gap:10px;">
    <div style="display:flex;align-items:center;gap:8px;"><span style="font-size:17px;">âœ…</span><div><div class="bbs" style="font-size:15px;letter-spacing:2px;color:#10b981;">WHAT WORKED</div><div class="msm" style="color:var(--dim);font-size:8px;margin-top:1px;">Tactics that landed today</div></div></div>
    <textarea id="fw" oninput="saveDeb()" onfocus="this.style.borderColor='rgba(16,185,129,.3)'" onblur="this.style.borderColor='var(--b)'" style="background:var(--s3);border:1px solid var(--b);border-radius:8px;padding:11px;color:var(--t);font-family:'DM Sans',sans-serif;font-size:13px;line-height:1.65;resize:vertical;min-height:100px;outline:none;width:100%;transition:border-color .2s,background .3s;"></textarea>
  </div>
  <div class="card" style="display:flex;flex-direction:column;gap:10px;">
    <div style="display:flex;align-items:center;gap:8px;"><span style="font-size:17px;">ğŸ”§</span><div><div class="bbs" style="font-size:15px;letter-spacing:2px;color:#f97316;">DO BETTER TOMORROW</div><div class="msm" style="color:var(--dim);font-size:8px;margin-top:1px;">Gaps and missed opps</div></div></div>
    <textarea id="fi" oninput="saveDeb()" onfocus="this.style.borderColor='rgba(249,115,22,.3)'" onblur="this.style.borderColor='var(--b)'" style="background:var(--s3);border:1px solid var(--b);border-radius:8px;padding:11px;color:var(--t);font-family:'DM Sans',sans-serif;font-size:13px;line-height:1.65;resize:vertical;min-height:100px;outline:none;width:100%;transition:border-color .2s,background .3s;"></textarea>
  </div>
  <div class="card" style="display:flex;flex-direction:column;gap:10px;">
    <div style="display:flex;align-items:center;gap:8px;"><span style="font-size:17px;">ğŸ¯</span><div><div id="focTitle" class="bbs" style="font-size:15px;letter-spacing:2px;color:#e8ff47;transition:color .3s;">TOMORROW&#39;S FOCUS</div><div class="msm" style="color:var(--dim);font-size:8px;margin-top:1px;">One method + number goal</div></div></div>
    <textarea id="ff" oninput="saveDeb()" onfocus="this.style.borderColor='rgba(232,255,71,.3)'" onblur="this.style.borderColor='var(--b)'" style="background:var(--s3);border:1px solid var(--b);border-radius:8px;padding:11px;color:var(--t);font-family:'DM Sans',sans-serif;font-size:13px;line-height:1.65;resize:vertical;min-height:100px;outline:none;width:100%;transition:border-color .2s,background .3s;"></textarea>
  </div>
</div>
<div style="margin-bottom:28px;">
  <button id="pastBtn" onclick="togglePast()" class="gbtn" style="width:100%;padding:7px 14px;" onmouseenter="this.style.borderColor='var(--b3)';this.style.color='var(--t2)'" onmouseleave="this.style.borderColor='var(--b)';this.style.color='var(--dim)'">&#9660; VIEW PAST DEBRIEFS</button>
  <div id="pastDebs" style="display:none;flex-direction:column;gap:8px;margin-top:12px;"></div>
</div>

<div id="motto" class="bbs" style="text-align:center;padding:18px 0;border-top:1px solid var(--b);font-size:11px;letter-spacing:5px;color:var(--dmt);">NO REPS = NO RESULTS â€” HORMOZI RULE OF 100</div>
</main>

<!-- MODALS -->

<!-- PROSPECT -->
<div id="mProspect" style="display:none;position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.85);backdrop-filter:blur(10px);align-items:center;justify-content:center;padding:20px;">
  <div class="si card" style="max-width:420px;width:100%;max-height:90vh;overflow-y:auto;">
    <div class="bbs" style="font-size:22px;letter-spacing:2px;color:#10b981;margin-bottom:16px;">ADD PROSPECT</div>
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div><div class="msm" style="color:var(--dim);font-size:8px;margin-bottom:5px;">NAME / COMPANY</div>
        <input id="pName" type="text" placeholder="e.g. John Smith â€” ABC Roofing" style="width:100%;background:var(--s3);border:1px solid var(--b);border-radius:8px;padding:10px 12px;color:var(--t);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;" onfocus="this.style.borderColor='#10b981aa'" onblur="this.style.borderColor=''"/></div>
      <div><div class="msm" style="color:var(--dim);font-size:8px;margin-bottom:5px;">STAGE</div>
        <select id="pStage" style="width:100%;background:var(--s3);border:1px solid var(--b);border-radius:8px;padding:10px 12px;color:var(--t);font-family:'DM Mono',monospace;font-size:11px;outline:none;cursor:pointer;"></select></div>
      <div>
        <div style="display:flex;justify-content:space-between;margin-bottom:5px;"><div class="msm" style="color:var(--dim);font-size:8px;">SOURCE â€” HOW DID YOU FIND THEM?</div><div class="msm" style="color:var(--dr);font-size:8px;">optional (nudge)</div></div>
        <select id="pSource" style="width:100%;background:var(--s3);border:1px solid var(--b);border-radius:8px;padding:10px 12px;color:var(--t);font-family:'DM Mono',monospace;font-size:11px;outline:none;cursor:pointer;">
          <option value="">â€” Select source â€”</option>
          <option value="Door Knock">ğŸšª Door Knock</option>
          <option value="Cold Call">ğŸ“ Cold Call</option>
          <option value="Cold Email">ğŸ“§ Cold Email</option>
          <option value="SMS">ğŸ’¬ SMS</option>
          <option value="Instagram DM">ğŸ“¸ Instagram DM</option>
          <option value="LinkedIn">ğŸ’¼ LinkedIn</option>
          <option value="Facebook">ğŸ“˜ Facebook</option>
          <option value="TikTok">ğŸµ TikTok</option>
          <option value="Referral">ğŸ¤ Referral</option>
          <option value="Warm Call">â˜ï¸ Warm Call</option>
          <option value="Inbound">ğŸ“¥ Inbound</option>
          <option value="Other">ğŸ” Other</option>
        </select></div>
      <div><div class="msm" style="color:var(--dim);font-size:8px;margin-bottom:5px;">VALUE ($) â€” OPTIONAL</div>
        <input id="pValue" type="number" placeholder="e.g. 8500" style="width:100%;background:var(--s3);border:1px solid var(--b);border-radius:8px;padding:10px 12px;color:var(--t);font-family:'DM Mono',monospace;font-size:13px;outline:none;" onfocus="this.style.borderColor='#10b981aa'" onblur="this.style.borderColor=''"/></div>
      <div><div class="msm" style="color:var(--dim);font-size:8px;margin-bottom:5px;">NOTES â€” OPTIONAL</div>
        <textarea id="pNotes" rows="2" placeholder="Next step, context..." style="width:100%;background:var(--s3);border:1px solid var(--b);border-radius:8px;padding:10px 12px;color:var(--t);font-family:'DM Sans',sans-serif;font-size:13px;line-height:1.5;resize:none;outline:none;" onfocus="this.style.borderColor='#10b981aa'" onblur="this.style.borderColor=''"></textarea></div>
    </div>
    <div style="display:flex;gap:10px;margin-top:18px;">
      <button onclick="closeProspect()" style="flex:1;padding:11px;border-radius:8px;border:1px solid var(--b2);background:transparent;color:var(--t3);cursor:pointer;font-family:'DM Mono',monospace;font-size:12px;letter-spacing:1px;">CANCEL</button>
      <button onclick="saveProspect()" style="flex:1;padding:11px;border-radius:8px;border:1px solid rgba(16,185,129,.3);background:rgba(16,185,129,.1);color:#10b981;cursor:pointer;font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:2px;">ADD</button>
    </div>
  </div>
</div>

<!-- ADD STAGE -->
<div id="mStage" style="display:none;position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.85);backdrop-filter:blur(10px);align-items:center;justify-content:center;padding:20px;">
  <div class="si card" style="max-width:340px;width:100%;">
    <div class="bbs" style="font-size:22px;letter-spacing:2px;color:#a855f7;margin-bottom:16px;">ADD PIPELINE STAGE</div>
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div><div class="msm" style="color:var(--dim);font-size:8px;margin-bottom:5px;">STAGE NAME</div>
        <input id="stgName" type="text" placeholder="e.g. Proposal, Negotiation..." style="width:100%;background:var(--s3);border:1px solid var(--b);border-radius:8px;padding:10px 12px;color:var(--t);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;" onfocus="this.style.borderColor='#a855f7aa'" onblur="this.style.borderColor=''"/></div>
      <div><div class="msm" style="color:var(--dim);font-size:8px;margin-bottom:8px;">COLOR</div>
        <div id="clrPick" style="display:flex;gap:8px;flex-wrap:wrap;"></div></div>
    </div>
    <div style="display:flex;gap:10px;margin-top:18px;">
      <button onclick="closeStageModal()" style="flex:1;padding:11px;border-radius:8px;border:1px solid var(--b2);background:transparent;color:var(--t3);cursor:pointer;font-family:'DM Mono',monospace;font-size:12px;letter-spacing:1px;">CANCEL</button>
      <button onclick="saveStage()" style="flex:1;padding:11px;border-radius:8px;border:1px solid rgba(168,85,247,.3);background:rgba(168,85,247,.1);color:#a855f7;cursor:pointer;font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:2px;">ADD</button>
    </div>
  </div>
</div>

<!-- LOG ACTION PROMPT -->
<div id="mLogAct" style="display:none;position:fixed;inset:0;z-index:350;background:rgba(0,0,0,.85);backdrop-filter:blur(10px);align-items:center;justify-content:center;padding:20px;">
  <div class="si card" style="max-width:340px;width:100%;text-align:center;">
    <div style="font-size:28px;margin-bottom:10px;">ğŸ¯</div>
    <div id="laTitle" class="bbs" style="font-size:20px;letter-spacing:2px;color:#10b981;margin-bottom:8px;line-height:1.2;">LOG A REP FOR THIS MOVE?</div>
    <div id="laSub" style="font-size:13px;color:var(--t3);line-height:1.6;margin-bottom:20px;"></div>
    <div style="display:flex;gap:10px;">
      <button onclick="closeLogAct()" style="flex:1;padding:11px;border-radius:8px;border:1px solid var(--b2);background:transparent;color:var(--t3);cursor:pointer;font-family:'DM Mono',monospace;font-size:12px;letter-spacing:1px;">SKIP</button>
      <button onclick="doLogAct()" style="flex:1;padding:11px;border-radius:8px;border:1px solid rgba(16,185,129,.3);background:rgba(16,185,129,.1);color:#10b981;cursor:pointer;font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:2px;">LOG IT</button>
    </div>
  </div>
</div>

<!-- RESET -->
<div id="mReset" style="display:none;position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.8);backdrop-filter:blur(10px);align-items:center;justify-content:center;padding:20px;">
  <div class="si card" style="max-width:340px;width:100%;text-align:center;">
    <div class="bbs" style="font-size:26px;letter-spacing:2px;color:#ef4444;margin-bottom:8px;">RESET TODAY?</div>
    <div style="font-size:13px;color:var(--t3);line-height:1.6;margin-bottom:22px;">Clears today's logged actions. XP, streak, history and pipeline stay intact.</div>
    <div style="display:flex;gap:10px;">
      <button onclick="closeReset()" style="flex:1;padding:11px;border-radius:8px;border:1px solid var(--b2);background:transparent;color:var(--t3);cursor:pointer;font-family:'DM Mono',monospace;font-size:12px;">CANCEL</button>
      <button onclick="doReset()"    style="flex:1;padding:11px;border-radius:8px;border:1px solid rgba(239,68,68,.3);background:rgba(239,68,68,.08);color:#ef4444;cursor:pointer;font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:2px;">RESET</button>
    </div>
  </div>
</div>

<!-- SHARE OVERLAY -->
<div id="shareOverlay" onclick="if(event.target===this)closeShare()">
  <div style="width:100%;max-width:400px;border-radius:16px;overflow:hidden;background:#090909;border:1px solid #e8ff4722;">
    <div id="shareContent" style="padding:24px;"></div>
    <div style="padding:0 24px 22px;display:flex;gap:10px;">
      <button onclick="copyShare()" style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(232,255,71,.3);background:rgba(232,255,71,.08);color:#e8ff47;cursor:pointer;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:2px;">ğŸ“‹ COPY TEXT</button>
      <button onclick="closeShare()" style="flex:1;padding:10px;border-radius:8px;border:1px solid var(--b2);background:transparent;color:var(--t3);cursor:pointer;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:1px;">CLOSE</button>
    </div>
  </div>
</div>

<div id="toasts" style="position:fixed;bottom:20px;right:16px;left:16px;z-index:500;display:flex;flex-direction:column;gap:8px;align-items:flex-end;pointer-events:none;"></div>

<script>
var C=376.99;
var STAGE_COLORS=['#3b82f6','#f97316','#10b981','#a855f7','#e8ff47','#ef4444','#06b6d4','#ec4899','#84cc16','#f59e0b'];
var DEF_STAGES=[
  {id:'contact',label:'CONTACT',color:'#555555'},
  {id:'engaged',label:'ENGAGED',color:'#3b82f6'},
  {id:'demo',   label:'DEMO',   color:'#f97316'},
  {id:'won',    label:'WON',    color:'#10b981'},
  {id:'closed', label:'CLOSED', color:'#ef4444'}
];
// Which method/platform to suggest logging when prospect moves to a stage
var STAGE_LOG={
  engaged:{mid:'warm',plat:'Calls',lbl:'Warm Outreach â€” Call'},
  demo:   {mid:'warm',plat:'Calls',lbl:'Warm Outreach â€” Call'},
  won:    {mid:'warm',plat:'Calls',lbl:'Warm Outreach â€” Call'},
  closed: {mid:'warm',plat:'Calls',lbl:'Warm Outreach â€” Call'}
};
var METHODS=[
  {id:'cold',   name:'Cold Outreach',   short:'COLD',   color:'#3b82f6',icon:'â„ï¸', desc:'Doors, calls, DMs, email, SMS to strangers',
   platforms:['Doors Knocked','Cold Calls','Cold Email','SMS','Instagram DM','LinkedIn','Facebook','TikTok'],type:'count'},
  {id:'warm',   name:'Warm Outreach',   short:'WARM',   color:'#f97316',icon:'ğŸ¤', desc:'Follow-ups, referrals, past clients',
   platforms:['Calls','Emails','SMS','Instagram','Facebook','LinkedIn','YouTube'],type:'count'},
  {id:'content',name:'Content Creation',short:'CONTENT',color:'#a855f7',icon:'ğŸ¯', desc:'Posts, videos, stories, reels',
   platforms:['Instagram','Facebook','LinkedIn','YouTube','TikTok'],type:'count'},
  {id:'ads',    name:'Paid Ads',        short:'ADS',    color:'#10b981',icon:'ğŸ’°', desc:'$1 spent = 1 action toward your 100',
   platforms:['Instagram','Facebook','LinkedIn','YouTube','TikTok'],type:'dollars'}
];
var LEVELS=[
  {level:1,name:'ROOKIE', minXP:0,    color:'#777'},
  {level:2,name:'GRINDER',minXP:500,  color:'#3b82f6'},
  {level:3,name:'HUSTLER',minXP:1500, color:'#f97316'},
  {level:4,name:'CLOSER', minXP:3500, color:'#a855f7'},
  {level:5,name:'MACHINE',minXP:7000, color:'#10b981'},
  {level:6,name:'LEGEND', minXP:15000,color:'#e8ff47'}
];
var MS=[
  {days:3,  icon:'âš¡',label:'3 DAYS', color:'#3b82f6'},
  {days:7,  icon:'ğŸ”¥',label:'1 WEEK', color:'#f97316'},
  {days:14, icon:'ğŸ’¥',label:'2 WEEKS',color:'#a855f7'},
  {days:21, icon:'ğŸ¯',label:'21 DAYS',color:'#10b981'},
  {days:30, icon:'ğŸ‘‘',label:'30 DAYS',color:'#e8ff47'},
  {days:60, icon:'ğŸ†',label:'60 DAYS',color:'#e8ff47'},
  {days:100,icon:'ğŸ’',label:'CENTURY',color:'#e8ff47'}
];

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function tk(){return new Date().toISOString().split('T')[0];}
function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2);}
function defMeth(){var m={};METHODS.forEach(function(md){m[md.id]={};md.platforms.forEach(function(p){m[md.id][p]=0;});});return m;}
function blankP(){return{xp:0,currentStreak:0,longestStreak:0,totalDays:0,history:{},lastSaved:''};}
function ldState(){try{var r=JSON.parse(localStorage.getItem('r100_today')||'null');if(r&&r.date===tk())return r;}catch(e){}return{date:tk(),methods:defMeth()};}
function ldProf(){try{var r=JSON.parse(localStorage.getItem('r100_prof')||'null');if(r)return Object.assign(blankP(),r);}catch(e){}return blankP();}
function ldDebs(){try{return JSON.parse(localStorage.getItem('r100_debs')||'{}');}catch(e){return{};}}
function ldPipe(){try{return JSON.parse(localStorage.getItem('r100_pipe')||'[]');}catch(e){return[];}}
function ldStages(){try{var r=JSON.parse(localStorage.getItem('r100_stages')||'null');if(r&&r.length)return r;}catch(e){}return JSON.parse(JSON.stringify(DEF_STAGES));}

var ST=ldState(),PR=ldProf(),PIPE=ldPipe(),STAGES=ldStages();
var prevTot=calcTot(ST.methods),msFired={},pastOpen=false;
var isDark=(localStorage.getItem('r100_theme')||'dark')==='dark';
var dragId=null,stageDragIdx=null,pendLA=null,selColor=STAGE_COLORS[0],defAddStage='';

function svState(){localStorage.setItem('r100_today',JSON.stringify(ST));}
function svProf(){localStorage.setItem('r100_prof',JSON.stringify(PR));}
function svDebs(d){localStorage.setItem('r100_debs',JSON.stringify(d));}
function svPipe(){localStorage.setItem('r100_pipe',JSON.stringify(PIPE));}
function svStages(){localStorage.setItem('r100_stages',JSON.stringify(STAGES));}

// â”€â”€ MATH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcTot(m){var t=0;METHODS.forEach(function(md){md.platforms.forEach(function(p){t+=(m[md.id]&&m[md.id][p])?m[md.id][p]:0;});});return t;}
function calcMT(m,id){var md=null;METHODS.forEach(function(x){if(x.id===id)md=x;});if(!md)return 0;return md.platforms.reduce(function(a,p){return a+((m[id]&&m[id][p])?m[id][p]:0);},0);}
function calcXP(t){var x=Math.round(Math.min(1,t/100)*200);if(t>=100)x+=150;return x;}
function grade(t){if(t>=100)return{g:'S',c:'#e8ff47'};if(t>=80)return{g:'A',c:'#10b981'};if(t>=60)return{g:'B',c:'#3b82f6'};if(t>=40)return{g:'C',c:'#f97316'};if(t>=20)return{g:'D',c:'#a855f7'};return{g:'F',c:'#ef4444'};}
function getLevel(xp){var c=LEVELS[0];LEVELS.forEach(function(l){if(xp>=l.minXP)c=l;});return c;}
function getNext(xp){for(var i=0;i<LEVELS.length;i++){if(xp<LEVELS[i].minXP)return LEVELS[i];}return null;}
function headline(tot,sk){
  if(tot>=100&&sk>=7)return{h:'ON FIRE. ğŸ”¥',s:sk+' day streak. Momentum compounding.'};
  if(tot>=100)return{h:'MISSION COMPLETE.',s:'100 actions locked in. Operators do this every day.'};
  if(tot>=75)return{h:'ALMOST LOCKED IN.',s:(100-tot)+' more. You can see the finish line.'};
  if(tot>=50)return{h:'HALFWAY THERE.',s:tot+' of 100. Do not let up.'};
  if(tot>=25)return{h:'BUILDING MOMENTUM.',s:tot+' logged. Keep the foot down.'};
  if(tot>0)return{h:'YOU STARTED.',s:tot+' logged. Stack the reps.'};
  return{h:'SHOW UP. DO THE WORK.',s:'Pick a method. Log 100 actions today. Any mix. No excuses.'};
}

// â”€â”€ THEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function applyTheme(dark){
  isDark=dark;document.documentElement.setAttribute('data-theme',dark?'dark':'light');
  document.getElementById('themeBtn').textContent=dark?'ğŸŒ™':'â˜€ï¸';
  var rc=dark?'#e8ff47':'#1a1a1a';
  document.getElementById('rArc').style.stroke=rc;document.getElementById('rGlow').style.stroke=rc;
  var ft=document.getElementById('focTitle');if(ft)ft.style.color=dark?'#e8ff47':'#1a1a1a';
  localStorage.setItem('r100_theme',dark?'dark':'light');
}
function toggleTheme(){applyTheme(!isDark);}

// â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render(){
  var tot=calcTot(ST.methods),xp=calcXP(tot),gd=grade(tot),hl=headline(tot,PR.currentStreak);
  var lv=getLevel(PR.xp),nxt=getNext(PR.xp),done=tot>=100;
  var off=C-C*Math.min(100,Math.round(tot/100*100))/100;
  document.getElementById('dateBadge').textContent=new Date().toLocaleDateString('en-US',{weekday:'long',month:'short',day:'numeric'}).toUpperCase();
  document.getElementById('rArc').style.strokeDashoffset=off;document.getElementById('rGlow').style.strokeDashoffset=off;
  document.getElementById('bigNum').textContent=tot;document.getElementById('bigNum').style.color=done?(isDark?'#e8ff47':'#111'):'var(--t)';
  var hero=document.getElementById('hero');hero.style.borderColor=done?(isDark?'#e8ff4733':'rgba(0,0,0,.2)'):'var(--b)';
  done?hero.classList.add('pg'):hero.classList.remove('pg');
  document.getElementById('headline').textContent=hl.h;document.getElementById('headline').style.color=done?(isDark?'#e8ff47':'#111'):'var(--t)';
  document.getElementById('subline').textContent=hl.s;
  document.getElementById('statRemain').textContent=done?'âœ“':String(100-tot);document.getElementById('statRemain').style.color=done?(isDark?'#e8ff47':'#111'):'var(--t3)';
  document.getElementById('statXP').textContent='+'+xp;
  document.getElementById('statGrade').textContent=gd.g;document.getElementById('statGrade').style.color=gd.c;
  document.getElementById('gLetter').textContent=gd.g;document.getElementById('gLetter').style.color=gd.c;
  document.getElementById('gBox').style.borderColor=gd.c+'44';document.getElementById('gBox').style.background=gd.c+'10';
  var sb=document.getElementById('streakBadge'),sk=PR.currentStreak;
  sb.innerHTML=(sk>0?'ğŸ”¥ ':'')+sk+' <span class="msm" style="font-size:8px;color:var(--t3);">DAY</span>';
  sb.style.color=sk>0?'#f97316':'var(--dr)';sb.style.borderColor=sk>0?'#f9731633':'var(--b)';sb.style.background=sk>0?'#f9731610':'transparent';
  var xpP=nxt?Math.round(((PR.xp-lv.minXP)/(nxt.minXP-lv.minXP))*100):100;
  document.getElementById('lvlLabel').textContent='LV.'+lv.level+' '+lv.name;document.getElementById('lvlLabel').style.color=lv.color;
  document.getElementById('xpLabel').textContent=PR.xp.toLocaleString()+' XP';
  document.getElementById('xpBar').style.width=xpP+'%';document.getElementById('xpBar').style.background=lv.color;document.getElementById('xpBar').style.boxShadow='0 0 8px '+lv.color+'66';
  document.getElementById('stDays').textContent=PR.totalDays;document.getElementById('stBest').textContent=PR.longestStreak;
  document.getElementById('stXP').textContent=PR.xp>=1000?(PR.xp/1000).toFixed(1)+'K':PR.xp;
  document.getElementById('motto').textContent=done?'TODAY YOU EARNED IT â€” SAME TIME TOMORROW':'NO REPS = NO RESULTS â€” HORMOZI RULE OF 100';
  document.getElementById('motto').style.color=done?(isDark?'#e8ff47':'#111'):'var(--dmt)';
  rMini();rMethods();rHistory();rMilestones();rWeekly();
}

function rMini(){
  var c=document.getElementById('miniCards');c.innerHTML='';
  METHODS.forEach(function(m,i){var a=calcMT(ST.methods,m.id);var el=document.createElement('div');el.className='fu';
    el.style.cssText='animation-delay:'+(i*50+100)+'ms;background:var(--s);border:1px solid '+(a>0?m.color+'33':'var(--b)')+';border-radius:10px;padding:11px 13px;position:relative;overflow:hidden;transition:border-color .3s,background .3s;';
    el.innerHTML='<div style="position:absolute;top:0;left:0;right:0;height:2px;background:'+m.color+';opacity:'+(a>0?.7:.15)+';"></div><div class="msm" style="color:var(--dim);letter-spacing:1.5px;font-size:8px;margin-bottom:4px;">'+m.short+'</div><div class="bbs" style="font-size:26px;line-height:1;color:'+(a>0?m.color:'var(--b3)')+';transition:color .2s;">'+(m.type==='dollars'?'$':'')+a+'</div>'+(a>0?'<div class="msm" style="color:var(--dim);margin-top:3px;font-size:8px;">'+Math.round(a/100*100)+'% pool</div>':'');
    c.appendChild(el);});
}

function rMethods(){
  var grid=document.getElementById('methodGrid');grid.innerHTML='';
  METHODS.forEach(function(m){
    var mt=calcMT(ST.methods,m.id),active=mt>0,rows='';
    m.platforms.forEach(function(p){
      var val=(ST.methods[m.id]&&ST.methods[m.id][p])?ST.methods[m.id][p]:0,pid=m.id;
      var brd='border:1px solid '+(val>0?'var(--b3)':'var(--b)')+';';
      if(m.type==='dollars'){
        rows+='<div style="display:grid;grid-template-columns:120px 1fr;align-items:center;gap:10px;"><div class="msm" style="color:'+(val>0?'var(--t2)':'var(--dim)')+';font-size:10px;letter-spacing:1px;">'+p.toUpperCase()+'</div><div style="display:flex;align-items:center;gap:6px;background:var(--s3);'+brd+'border-radius:8px;padding:6px 10px;"><span class="msm" style="color:var(--dim);">$</span><input type="number" min="0" value="'+(val||'')+'" placeholder="0" oninput="upd(\''+pid+'\',\''+p+'\',this.value)" style="flex:1;background:transparent;border:none;color:var(--t);outline:none;font-family:\'Bebas Neue\',sans-serif;font-size:22px;width:100%;"/></div></div>';
      }else{
        rows+='<div style="display:grid;grid-template-columns:120px 1fr;align-items:center;gap:10px;"><div class="msm" style="color:'+(val>0?'var(--t2)':'var(--dim)')+';font-size:10px;letter-spacing:1px;">'+p.toUpperCase()+'</div><div style="display:flex;align-items:center;gap:5px;background:var(--s3);'+brd+'border-radius:8px;padding:5px 7px;"><button onclick="upd(\''+pid+'\',\''+p+'\','+(Math.max(0,val-1))+')" style="width:30px;height:30px;border-radius:6px;border:1px solid var(--b2);background:var(--s2);color:var(--t3);font-size:17px;display:flex;align-items:center;justify-content:center;flex-shrink:0;cursor:pointer;transition:all .15s;" onmouseenter="this.style.borderColor=\'#e8ff47\';this.style.color=\'#e8ff47\';" onmouseleave="this.style.borderColor=\'\';this.style.color=\'\';">&#8722;</button><input type="number" min="0" value="'+(val||'')+'" placeholder="0" onchange="upd(\''+pid+'\',\''+p+'\',this.value)" style="flex:1;background:transparent;border:none;color:var(--t);outline:none;text-align:center;font-family:\'Bebas Neue\',sans-serif;font-size:22px;"/><button onclick="upd(\''+pid+'\',\''+p+'\','+(val+1)+')" style="width:30px;height:30px;border-radius:6px;border:1px solid var(--b2);background:var(--s2);color:var(--t3);font-size:17px;display:flex;align-items:center;justify-content:center;flex-shrink:0;cursor:pointer;transition:all .15s;" onmouseenter="this.style.borderColor=\'#e8ff47\';this.style.color=\'#e8ff47\';" onmouseleave="this.style.borderColor=\'\';this.style.color=\'\';">&#43;</button></div></div>';
      }
    });
    var contrib=active?'<div style="padding:0 16px 14px;"><div style="display:flex;justify-content:space-between;margin-bottom:5px;"><span class="msm" style="color:var(--dim);font-size:9px;">POOL CONTRIBUTION</span><span class="msm" style="color:'+m.color+';font-size:9px;">'+Math.round(mt/100*100)+'%</span></div><div style="height:3px;background:var(--s3);border-radius:2px;overflow:hidden;"><div style="height:100%;width:'+Math.min(100,mt/100*100)+'%;background:'+m.color+';border-radius:2px;box-shadow:0 0 6px '+m.color+'66;transition:width .4s cubic-bezier(.34,1.56,.64,1);"></div></div></div>':'';
    var card=document.createElement('div');
    card.style.cssText='background:var(--s);border:1px solid '+(active?m.color+'33':'var(--b)')+';border-radius:12px;overflow:hidden;transition:border-color .3s,background .3s;';
    card.innerHTML='<div style="padding:13px 16px;background:var(--s2);border-bottom:1px solid var(--b);display:flex;align-items:center;justify-content:space-between;"><div style="display:flex;align-items:center;gap:9px;"><span style="font-size:19px;">'+m.icon+'</span><div><div class="bbs" style="font-size:17px;letter-spacing:2px;">'+m.name+'</div><div class="msm" style="color:var(--dim);font-size:9px;margin-top:1px;">'+m.desc+'</div></div></div><div style="text-align:right;"><div class="bbs" style="font-size:28px;line-height:1;color:'+(active?m.color:'var(--b3)')+';transition:color .2s;">'+(m.type==='dollars'?'$':'')+mt+'</div>'+(active?'<div class="msm" style="color:var(--dim);font-size:9px;margin-top:1px;">LOGGED</div>':'')+'</div></div><div style="padding:10px 16px 14px;display:flex;flex-direction:column;gap:8px;">'+rows+'</div>'+contrib;
    grid.appendChild(card);
  });
}

// â”€â”€ PIPELINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fillStageSelects(){
  var sel=document.getElementById('pStage');if(!sel)return;
  sel.innerHTML=STAGES.map(function(s){return '<option value="'+s.id+'">'+s.label+'</option>';}).join('');
}

function rPipeline(){
  var g=document.getElementById('pipeGrid');g.innerHTML='';
  g.style.gridTemplateColumns='repeat('+STAGES.length+',minmax(160px,1fr))';
  STAGES.forEach(function(s,si){
    var prospects=PIPE.filter(function(p){return p.stage===s.id;});
    var wrap=document.createElement('div');wrap.style.minWidth='0';
    // Header
    var hdr=document.createElement('div');
    hdr.style.cssText='display:flex;align-items:center;gap:4px;margin-bottom:8px;';
    hdr.innerHTML=
      '<div draggable="true" data-si="'+si+'" title="Drag to reorder" style="cursor:grab;color:var(--dim);font-size:14px;padding:2px 3px;flex-shrink:0;">â ¿</div>'+
      '<div class="bbs" style="font-size:13px;letter-spacing:2px;color:'+s.color+';flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">'+esc(s.label)+'</div>'+
      '<span class="msm" style="font-size:9px;background:'+s.color+'18;padding:2px 7px;border-radius:10px;color:'+s.color+';flex-shrink:0;">'+prospects.length+'</span>'+
      (si>=1&&si<=STAGES.length-2?'<button onclick="delStage(\''+s.id+'\')" style="width:18px;height:18px;border:none;background:transparent;color:var(--dr);cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center;border-radius:3px;flex-shrink:0;transition:color .15s;" onmouseenter="this.style.color=\'#ef4444\'" onmouseleave="this.style.color=\'\'">Ã—</button>':'');
    hdr.querySelector('[data-si]').addEventListener('dragstart',function(e){stageDragIdx=si;e.dataTransfer.effectAllowed='move';});
    // Body
    var body=document.createElement('div');body.className='plcol';body.dataset.stage=s.id;
    body.style.borderColor=prospects.length>0?s.color+'33':'var(--b)';
    body.addEventListener('dragover',function(e){e.preventDefault();this.classList.add('dov');});
    body.addEventListener('dragleave',function(){this.classList.remove('dov');});
    body.addEventListener('drop',function(e){
      e.preventDefault();this.classList.remove('dov');
      if(stageDragIdx!==null){
        var moved=STAGES.splice(stageDragIdx,1)[0];STAGES.splice(si,0,moved);
        stageDragIdx=null;svStages();rPipeline();fillStageSelects();return;
      }
      if(!dragId)return;
      var oldStage=null;PIPE.forEach(function(p){if(p.id===dragId)oldStage=p.stage;});
      var newStage=this.dataset.stage;
      if(oldStage===newStage){dragId=null;return;}
      PIPE.forEach(function(p){if(p.id===dragId)p.stage=newStage;});
      svPipe();dragId=null;rPipeline();
      offerLog(newStage);
    });
    // Cards
    prospects.forEach(function(p){
      var card=document.createElement('div');card.className='pc';card.draggable=true;card.dataset.id=p.id;
      card.style.borderLeftColor=s.color+'66';
      var srcTag=p.source?'<span class="msm" style="font-size:8px;color:'+s.color+';background:'+s.color+'12;padding:2px 6px;border-radius:3px;">'+esc(p.source)+'</span>':'';
      card.innerHTML='<div style="display:flex;align-items:flex-start;justify-content:space-between;gap:6px;">'+
        '<div style="min-width:0;flex:1;"><div style="font-weight:600;font-size:13px;color:var(--t);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">'+esc(p.name)+'</div>'+
        '<div style="display:flex;gap:5px;align-items:center;margin-top:4px;flex-wrap:wrap;">'+(p.value?'<span class="msm" style="font-size:8px;color:#10b981;">$'+Number(p.value).toLocaleString()+'</span>':'')+srcTag+'</div>'+
        (p.notes?'<div style="font-size:11px;color:var(--t2);margin-top:5px;line-height:1.4;">'+esc(p.notes)+'</div>':'')+
        '</div><button onclick="delProspect(\''+p.id+'\')" style="width:20px;height:20px;border:none;background:transparent;color:var(--dim);cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;flex-shrink:0;border-radius:3px;transition:color .15s;" onmouseenter="this.style.color=\'#ef4444\'" onmouseleave="this.style.color=\'\'">Ã—</button></div>';
      card.addEventListener('dragstart',function(e){dragId=p.id;card.classList.add('dragging');e.dataTransfer.effectAllowed='move';});
      card.addEventListener('dragend',function(){card.classList.remove('dragging');});
      body.appendChild(card);
    });
    var addB=document.createElement('button');addB.className='addbtn';addB.textContent='+ ADD';
    addB.onclick=function(){showAddProspect(s.id);};body.appendChild(addB);
    wrap.appendChild(hdr);wrap.appendChild(body);g.appendChild(wrap);
  });
  rPipeSummary();rSourceBreak();fillStageSelects();
}
document.addEventListener('dragend',function(){stageDragIdx=null;});

function rPipeSummary(){
  var c=document.getElementById('pipeSummary');c.innerHTML='';
  var totVal=0;PIPE.forEach(function(p){if(p.value)totVal+=Number(p.value);});
  var wonS=STAGES.find(function(s){return s.id==='won';})||STAGES[STAGES.length-2]||STAGES[0];
  var wonVal=PIPE.filter(function(p){return p.stage===wonS.id;}).reduce(function(a,p){return a+(Number(p.value)||0);},0);
  var closedS=STAGES.find(function(s){return s.id==='closed';})||STAGES[STAGES.length-1]||STAGES[0];
  var active=PIPE.filter(function(p){return p.stage!==closedS.id;}).length;
  var wonCnt=PIPE.filter(function(p){return p.stage===wonS.id;}).length;
  var closeRate=PIPE.length>0?Math.round(wonCnt/PIPE.length*100):0;
  var pills=[
    {l:'PROSPECTS',v:PIPE.length,c:'var(--t3)'},
    {l:'PIPELINE VALUE',v:'$'+totVal.toLocaleString(),c:'#10b981'},
    {l:'REVENUE WON',v:'$'+wonVal.toLocaleString(),c:isDark?'#e8ff47':'#111'},
    {l:'ACTIVE DEALS',v:active,c:'#f97316'},
    {l:'CLOSE RATE',v:closeRate+'%',c:'#a855f7'}
  ];
  pills.forEach(function(p){var el=document.createElement('div');el.style.cssText='background:var(--s);border:1px solid var(--b);border-radius:8px;padding:9px 13px;';el.innerHTML='<div class="bbs" style="font-size:20px;color:'+p.c+';">'+p.v+'</div><div class="msm" style="color:var(--dr);font-size:8px;letter-spacing:1.5px;margin-top:2px;">'+p.l+'</div>';c.appendChild(el);});
}

// â”€â”€ CLOSE RATE BY SOURCE (Feature #5) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rSourceBreak(){
  var c=document.getElementById('sourceBreak');
  var wonS=STAGES.find(function(s){return s.id==='won';})||STAGES[STAGES.length-2]||STAGES[0];
  var wonDeals=PIPE.filter(function(p){return p.stage===wonS.id&&p.source;});
  if(!wonDeals.length){c.innerHTML='';return;}
  var bySource={};
  wonDeals.forEach(function(p){bySource[p.source]=(bySource[p.source]||0)+1;});
  var sorted=Object.keys(bySource).sort(function(a,b){return bySource[b]-bySource[a];});
  var bars=sorted.map(function(src,i){
    var wonCnt=bySource[src];
    var fromSrc=PIPE.filter(function(p){return p.source===src;}).length;
    var rate=fromSrc>0?Math.round(wonCnt/fromSrc*100):0;
    var pct=Math.round(wonCnt/wonDeals.length*100);
    var cols=['#10b981','#3b82f6','#f97316','#a855f7','#e8ff47','#ef4444','#06b6d4','#ec4899'];
    var col=cols[i%cols.length];
    return '<div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;">'+
      '<div class="msm" style="width:110px;font-size:9px;color:var(--t2);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:0;">'+esc(src)+'</div>'+
      '<div style="flex:1;height:8px;background:var(--s3);border-radius:4px;overflow:hidden;"><div style="height:100%;width:'+pct+'%;background:'+col+';border-radius:4px;transition:width .5s cubic-bezier(.34,1.56,.64,1);box-shadow:0 0 6px '+col+'44;"></div></div>'+
      '<div class="msm" style="width:80px;font-size:9px;color:'+col+';text-align:right;flex-shrink:0;">'+wonCnt+' WON ('+rate+'%)</div>'+
    '</div>';
  }).join('');
  c.innerHTML='<div class="card" style="margin-bottom:14px;"><div class="slbl">CLOSE RATE BY SOURCE</div>'+bars+
    '<div class="msm" style="color:var(--dr);font-size:8px;margin-top:10px;">'+wonDeals.length+' won deal'+(wonDeals.length!==1?'s':'')+' with source tagged</div></div>';
}

// â”€â”€ LOG ACTION FROM PIPELINE MOVE (Feature #2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function offerLog(stageId){
  var map=STAGE_LOG[stageId]||{mid:'warm',plat:'Calls',lbl:'Warm Outreach â€” Call'};
  pendLA=map;
  var so=STAGES.find(function(s){return s.id===stageId;})||{label:stageId.toUpperCase()};
  document.getElementById('laSub').textContent='You moved a prospect to '+so.label+'. Count it as a '+map.lbl+' action toward your 100?';
  document.getElementById('mLogAct').style.display='flex';
}
function closeLogAct(){document.getElementById('mLogAct').style.display='none';pendLA=null;}
function doLogAct(){
  if(!pendLA){closeLogAct();return;}
  var cur=(ST.methods[pendLA.mid]&&ST.methods[pendLA.mid][pendLA.plat])?ST.methods[pendLA.mid][pendLA.plat]:0;
  upd(pendLA.mid,pendLA.plat,cur+1);
  closeLogAct();toast('REP LOGGED!','Pipeline move counted toward your 100.','#10b981','âš¡');
}

// â”€â”€ STAGE CRUD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showAddStage(){
  document.getElementById('stgName').value='';selColor=STAGE_COLORS[0];
  var cp=document.getElementById('clrPick');
  cp.innerHTML=STAGE_COLORS.map(function(col,i){return '<div onclick="pickColor(\''+col+'\')" id="clr'+i+'" style="width:28px;height:28px;border-radius:6px;background:'+col+';cursor:pointer;border:2px solid '+(i===0?'#fff':'transparent')+';transition:border-color .15s;" title="'+col+'"></div>';}).join('');
  document.getElementById('mStage').style.display='flex';
  setTimeout(function(){document.getElementById('stgName').focus();},100);
}
function pickColor(col){selColor=col;document.querySelectorAll('#clrPick div').forEach(function(el){el.style.borderColor=el.title===col?'#fff':'transparent';});}
function closeStageModal(){document.getElementById('mStage').style.display='none';}
function saveStage(){
  var n=document.getElementById('stgName').value.trim().toUpperCase();if(!n)return;
  var id='stg_'+uid();
  var ci=STAGES.findIndex(function(s){return s.id==='closed';});
  var ns={id:id,label:n,color:selColor};
  if(ci>-1)STAGES.splice(ci,0,ns);else STAGES.push(ns);
  STAGE_LOG[id]={mid:'warm',plat:'Calls',lbl:'Warm Outreach â€” Call'};
  svStages();rPipeline();fillStageSelects();closeStageModal();
  toast('STAGE ADDED',n+' is ready for prospects.','#a855f7','ğŸ—ï¸');
}
function delStage(id){
  if(PIPE.some(function(p){return p.stage===id;})){toast('STAGE NOT EMPTY','Move all prospects out first.','#ef4444','âš ï¸');return;}
  STAGES=STAGES.filter(function(s){return s.id!==id;});svStages();rPipeline();fillStageSelects();
}

// â”€â”€ PROSPECT CRUD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showAddProspect(stgId){
  defAddStage=stgId||STAGES[0].id;
  document.getElementById('pName').value='';document.getElementById('pSource').value='';
  document.getElementById('pValue').value='';document.getElementById('pNotes').value='';
  fillStageSelects();document.getElementById('pStage').value=defAddStage;
  document.getElementById('mProspect').style.display='flex';
  setTimeout(function(){document.getElementById('pName').focus();},100);
}
function closeProspect(){document.getElementById('mProspect').style.display='none';}
function saveProspect(){
  var name=document.getElementById('pName').value.trim();if(!name){document.getElementById('pName').focus();return;}
  var src=document.getElementById('pSource').value;
  if(!src&&!window._srcNudged){window._srcNudged=true;toast('TIP: ADD A SOURCE','Tracking source powers your close rate analysis.','#f97316','ğŸ’¡');}
  PIPE.push({id:uid(),name:name,stage:document.getElementById('pStage').value,source:src,value:document.getElementById('pValue').value||'',notes:document.getElementById('pNotes').value.trim(),createdAt:Date.now()});
  svPipe();rPipeline();closeProspect();toast('PROSPECT ADDED','Drag to move between stages.','#10b981','ğŸ¯');
}
function delProspect(id){PIPE=PIPE.filter(function(p){return p.id!==id;});svPipe();rPipeline();}

// â”€â”€ SHARE CARD (Feature #7) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openShare(){
  var tot=calcTot(ST.methods),gd=grade(tot),sk=PR.currentStreak;
  var wonS=STAGES.find(function(s){return s.id==='won';})||STAGES[STAGES.length-2]||STAGES[0];
  var wonCnt=PIPE.filter(function(p){return p.stage===wonS.id;}).length;
  var date=new Date().toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'});
  var bdown=METHODS.filter(function(m){return calcMT(ST.methods,m.id)>0;}).map(function(m){
    var t=calcMT(ST.methods,m.id);
    return '<div style="display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid #ffffff08;">'+
      '<span style="font-size:12px;color:#888;">'+m.icon+' '+m.name+'</span>'+
      '<span style="font-family:Bebas Neue,sans-serif;font-size:16px;color:'+m.color+';">'+(m.type==='dollars'?'$':'')+t+'</span></div>';
  }).join('');
  document.getElementById('shareContent').innerHTML=
    '<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;">'+
      '<div><div style="font-family:Bebas Neue,sans-serif;font-size:26px;letter-spacing:4px;color:#e8ff47;line-height:1;">RULE OF 100</div>'+
      '<div style="font-family:DM Mono,monospace;font-size:9px;letter-spacing:2px;color:#444;margin-top:2px;">'+date.toUpperCase()+'</div></div>'+
      '<div style="text-align:right;"><div style="font-family:Bebas Neue,sans-serif;font-size:54px;line-height:1;color:'+gd.c+';">'+gd.g+'</div>'+
      '<div style="font-family:DM Mono,monospace;font-size:8px;color:#444;letter-spacing:2px;">GRADE</div></div>'+
    '</div>'+
    '<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:18px;">'+
      sBox(tot,'ACTIONS',tot>=100?'#e8ff47':'#888')+sBox(Math.max(0,100-tot),'LEFT',tot>=100?'#10b981':'#555')+sBox(sk,'STREAK','#f97316')+sBox(wonCnt,'WON','#10b981')+
    '</div>'+
    (bdown?'<div style="border-top:1px solid #1c1c1c;padding-top:14px;margin-bottom:14px;">'+bdown+'</div>':'')+
    '<div style="font-family:DM Mono,monospace;font-size:9px;letter-spacing:2px;color:#333;text-align:center;border-top:1px solid #1c1c1c;padding-top:12px;">NO REPS = NO RESULTS &middot; RULE OF 100</div>';
  document.getElementById('shareOverlay').style.display='flex';
}
function sBox(v,l,col){return '<div style="background:#0c0c0c;border:1px solid #1c1c1c;border-radius:8px;padding:9px 8px;text-align:center;"><div style="font-family:Bebas Neue,sans-serif;font-size:26px;line-height:1;color:'+col+';">'+v+'</div><div style="font-family:DM Mono,monospace;font-size:8px;color:#444;letter-spacing:1.5px;margin-top:2px;">'+l+'</div></div>';}
function closeShare(){document.getElementById('shareOverlay').style.display='none';}
function copyShare(){
  var tot=calcTot(ST.methods),gd=grade(tot),sk=PR.currentStreak;
  var date=new Date().toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'});
  var lines=['ğŸ“Š RULE OF 100 â€” '+date.toUpperCase(),'','Grade: '+gd.g+' | Actions: '+tot+'/100 | Streak: '+sk+' days',''];
  METHODS.forEach(function(m){var t=calcMT(ST.methods,m.id);if(t>0)lines.push(m.icon+' '+m.name+': '+(m.type==='dollars'?'$':'')+t);});
  lines.push('','No reps = no results. â€” Hormozi Rule of 100');
  var txt=lines.join('\n');
  if(navigator.clipboard){navigator.clipboard.writeText(txt).then(function(){toast('COPIED!','Ready to paste.','#e8ff47','ğŸ“‹');});}
  else{var ta=document.createElement('textarea');ta.value=txt;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);toast('COPIED!','Ready to paste.','#e8ff47','ğŸ“‹');}
}

// â”€â”€ HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rHistory(){
  var today=new Date(),cells=[];
  for(var i=27;i>=0;i--){var d=new Date(today);d.setDate(today.getDate()-i);var key=d.toISOString().split('T')[0];var rec=PR.history[key];var acts=rec?rec.totalActions:null;var gd=acts!==null?grade(acts):{g:'',c:''};cells.push({key:key,acts:acts,g:gd.g,c:gd.c,isToday:key===tk()});}
  var dl=['S','M','T','W','T','F','S'];
  var h='<div style="display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:4px;">';
  dl.forEach(function(d){h+='<div class="msm" style="font-size:9px;color:var(--dr);text-align:center;letter-spacing:1px;">'+d+'</div>';});
  h+='</div><div style="display:grid;grid-template-columns:repeat(7,1fr);gap:3px;">';
  cells.forEach(function(cell){var bg=cell.acts!==null?cell.c+(cell.acts>=100?'2a':'14'):'var(--s3)';var brd=cell.isToday?(isDark?'#e8ff47':'#111'):(cell.acts!==null?cell.c+'33':'var(--b)');h+='<div title="'+cell.key+(cell.acts!==null?': '+cell.acts+' actions':'')+'" style="aspect-ratio:1/1;border-radius:5px;background:'+bg+';border:1px solid '+brd+';display:flex;align-items:center;justify-content:center;">'+(cell.g?'<span class="bbs" style="font-size:12px;color:'+cell.c+';">'+cell.g+'</span>':'')+'</div>';});
  h+='</div><div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;">';
  [{g:'S',c:'#e8ff47',l:'100%'},{g:'A',c:'#10b981',l:'80+'},{g:'B',c:'#3b82f6',l:'60+'},{g:'C',c:'#f97316',l:'40+'},{g:'D',c:'#a855f7',l:'20+'},{g:'F',c:'#ef4444',l:'<20'}].forEach(function(le){h+='<div style="display:flex;align-items:center;gap:4px;"><div style="width:12px;height:12px;border-radius:3px;background:'+le.c+'18;border:1px solid '+le.c+'44;display:flex;align-items:center;justify-content:center;"><span class="bbs" style="font-size:8px;color:'+le.c+';">'+le.g+'</span></div><span class="msm" style="color:var(--dim);font-size:8px;">'+le.l+'</span></div>';});
  h+='</div>';document.getElementById('histGrid').innerHTML=h;
}

function rMilestones(){
  var c=document.getElementById('milestones');c.innerHTML='';
  MS.forEach(function(ms){var ach=PR.longestStreak>=ms.days,act=PR.currentStreak>=ms.days;var el=document.createElement('div');el.title=ach?'Achieved! Best: '+PR.longestStreak+' days':(ms.days-PR.currentStreak)+' more days needed';el.style.cssText='background:'+(ach?ms.color+'12':'var(--s3)')+';border:1px solid '+(ach?ms.color+'44':'var(--b)')+';border-radius:8px;padding:7px 10px;display:flex;flex-direction:column;align-items:center;gap:3px;opacity:'+(ach?1:.3)+';transition:all .3s;min-width:56px;position:relative;';if(act&&ach){var dot=document.createElement('div');dot.className='bl';dot.style.cssText='position:absolute;top:-4px;right:-4px;width:7px;height:7px;border-radius:50%;background:'+ms.color+';box-shadow:0 0 7px '+ms.color+';';el.appendChild(dot);}el.innerHTML+='<span style="font-size:16px;">'+ms.icon+'</span><span class="msm" style="font-size:8px;letter-spacing:1px;color:'+(ach?ms.color:'var(--dim)')+';text-align:center;line-height:1.3;">'+ms.label+'</span>';c.appendChild(el);});
}

function rWeekly(){
  var container=document.getElementById('weeklySummary'),today=new Date(),wds=[];
  for(var i=6;i>=0;i--){var d=new Date(today);d.setDate(today.getDate()-i);var key=d.toISOString().split('T')[0];var rec=PR.history[key];var acts=rec?rec.totalActions:(key===tk()?calcTot(ST.methods):0);wds.push({key:key,label:d.toLocaleDateString('en-US',{weekday:'short'}).toUpperCase(),acts:acts,isToday:key===tk()});}
  var totW=wds.reduce(function(a,d){return a+d.acts;},0),dHit=wds.filter(function(d){return d.acts>=100;}).length,avg=Math.round(totW/7);
  var mTots={};METHODS.forEach(function(m){mTots[m.id]=0;});
  wds.forEach(function(d){if(d.key===tk()){METHODS.forEach(function(m){mTots[m.id]+=calcMT(ST.methods,m.id);});}else if(PR.history[d.key]&&PR.history[d.key].methods){var hm=PR.history[d.key].methods;METHODS.forEach(function(m){mTots[m.id]+=calcMT(hm,m.id);});}});
  var topM=null,topC=0;METHODS.forEach(function(m){if(mTots[m.id]>topC){topC=mTots[m.id];topM=m;}});
  var maxA=Math.max(100,Math.max.apply(null,wds.map(function(d){return d.acts;})));
  var bars=wds.map(function(d){var bp=Math.min(100,Math.round(d.acts/maxA*100));var gd=d.acts>0?grade(d.acts):{c:'var(--b)'};var bc=d.acts>=100?(isDark?'#e8ff47':'#111'):(d.acts>0?gd.c:'var(--b)');return '<div style="display:flex;flex-direction:column;align-items:center;gap:5px;flex:1;"><div class="msm" style="font-size:9px;color:'+(d.acts>0?'var(--t2)':'var(--dr)')+';">'+d.acts+'</div><div style="width:100%;height:60px;background:var(--s3);border-radius:5px;overflow:hidden;display:flex;align-items:flex-end;"><div style="width:100%;height:'+bp+'%;background:'+bc+';border-radius:5px;transition:height .5s cubic-bezier(.34,1.56,.64,1);'+(d.acts>=100?'box-shadow:0 0 8px '+bc+'66;':'')+'"></div></div><div class="msm" style="font-size:8px;color:'+(d.isToday?(isDark?'#e8ff47':'#111'):'var(--dr)')+';">'+d.label+'</div></div>';}).join('');
  var ins=dHit===7?'Perfect week. Every single day. Elite operator behavior.':dHit>=5?dHit+' of 7 days hit. Solid. Plug the gaps.':dHit>=3?dHit+' days hit. Inconsistency kills momentum. Fix that.':totW===0?'Nothing logged yet. Every day you wait costs compounding.':dHit+' of 7 days hit. Operators do this every day.';
  container.innerHTML='<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:18px;">'+
    sp('THIS WEEK',totW,'actions')+sp('DAYS HIT',dHit+'/7','')+sp('DAILY AVG',avg,'actions')+sp('TOP METHOD',topM?topM.short:'â€”','')+
  '</div><div style="display:flex;gap:6px;align-items:flex-end;margin-bottom:14px;">'+bars+'</div>'+
  '<div style="display:flex;align-items:center;gap:8px;margin-bottom:16px;"><div style="flex:1;height:1px;background:var(--b);"></div><div class="msm" style="color:var(--dr);font-size:8px;white-space:nowrap;">100 ACTION TARGET</div><div style="flex:1;height:1px;background:var(--b);"></div></div>'+
  '<div style="background:var(--s3);border:1px solid var(--b);border-radius:8px;padding:13px 15px;"><div class="msm" style="color:var(--dr);font-size:8px;letter-spacing:2px;margin-bottom:5px;">WEEKLY INSIGHT</div><div style="font-size:13px;color:var(--t2);line-height:1.6;">'+ins+'</div></div>';
}
function sp(l,v,u){return '<div style="background:var(--s3);border:1px solid var(--b);border-radius:8px;padding:11px 12px;text-align:center;"><div class="bbs" style="font-size:22px;line-height:1;color:var(--t);">'+v+'</div>'+(u?'<div class="msm" style="color:var(--dim);font-size:8px;margin-top:2px;">'+u+'</div>':'')+' <div class="msm" style="color:var(--dr);font-size:8px;margin-top:3px;letter-spacing:1.5px;">'+l+'</div></div>';}

// â”€â”€ INTERACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function upd(mid,plat,rawVal){
  var val=Math.max(0,parseInt(rawVal)||0);if(!ST.methods[mid])ST.methods[mid]={};ST.methods[mid][plat]=val;svState();
  var newTot=calcTot(ST.methods),old=prevTot;
  if(old<25&&newTot>=25){boom('small');toast('25 ACTIONS!','Quarter way. Keep going.','#e8ff47','âš¡');}
  if(old<50&&newTot>=50){boom('small');toast('HALFWAY DONE!','50 logged. Keep stacking.','#e8ff47','ğŸ’¥');}
  if(old<75&&newTot>=75){boom('medium');toast('75 ACTIONS!','Final push. 25 to go.','#f97316','ğŸ¯');}
  if(old<100&&newTot>=100){boom('big');toast('DAY COMPLETE! ğŸ”¥','+350 XP locked in.','#10b981','ğŸ‘‘');commitDay();}
  prevTot=newTot;render();
}
function commitDay(){
  var today=tk();if(PR.lastSaved===today)return;
  var tot=calcTot(ST.methods),xp=calcXP(tot),gd=grade(tot);
  var yd=new Date();yd.setDate(yd.getDate()-1);var yk=yd.toISOString().split('T')[0];
  var hadY=PR.history[yk]&&PR.history[yk].totalActions>=100;
  var nsk=tot>=100?(hadY?PR.currentStreak+1:1):0;
  MS.forEach(function(ms){if(nsk>=ms.days&&!msFired[ms.days]){msFired[ms.days]=true;(function(d){setTimeout(function(){boom('mega');toast(d+' DAY STREAK!','Milestone unlocked!','#f97316','ğŸ†');},1200);})(ms.days);}});
  PR.xp+=xp;PR.currentStreak=nsk;PR.longestStreak=Math.max(PR.longestStreak,nsk);PR.totalDays++;
  PR.history[today]={date:today,totalActions:tot,xpEarned:xp,grade:gd.g,methods:JSON.parse(JSON.stringify(ST.methods))};
  PR.lastSaved=today;svProf();
}

// â”€â”€ DEBRIEF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveDeb(){
  var d=ldDebs();d[tk()]={date:tk(),wins:document.getElementById('fw').value,improve:document.getElementById('fi').value,focus:document.getElementById('ff').value};
  svDebs(d);var el=document.getElementById('debSaved');el.textContent='âœ“ SAVED';el.style.color='#10b981';
  clearTimeout(window._dbt);window._dbt=setTimeout(function(){el.style.color='var(--dr)';el.textContent='';},2000);
}
function ldTodayDeb(){var r=ldDebs()[tk()];if(!r)return;document.getElementById('fw').value=r.wins||'';document.getElementById('fi').value=r.improve||'';document.getElementById('ff').value=r.focus||'';}
function togglePast(){
  pastOpen=!pastOpen;var c=document.getElementById('pastDebs'),btn=document.getElementById('pastBtn');
  if(pastOpen){rPastDebs();c.style.display='flex';btn.textContent='â–² HIDE PAST DEBRIEFS';}else{c.style.display='none';btn.textContent='â–¼ VIEW PAST DEBRIEFS';}
}
function rPastDebs(){
  var c=document.getElementById('pastDebs');
  var entries=Object.values(ldDebs()).filter(function(d){return d.date!==tk()&&(d.wins||d.improve||d.focus);}).sort(function(a,b){return b.date.localeCompare(a.date);}).slice(0,14);
  if(!entries.length){c.innerHTML='<div class="msm" style="color:var(--dr);text-align:center;padding:20px;width:100%;">NO PAST ENTRIES YET</div>';return;}
  c.innerHTML=entries.map(function(d){
    var dl=new Date(d.date+'T12:00:00').toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'}).toUpperCase();
    var pts=[];if(d.wins)pts.push({icon:'âœ…',color:'#10b981',label:'WHAT WORKED',text:d.wins});if(d.improve)pts.push({icon:'ğŸ”§',color:'#f97316',label:'DO BETTER',text:d.improve});if(d.focus)pts.push({icon:'ğŸ¯',color:isDark?'#e8ff47':'#1a1a1a',label:'FOCUS',text:d.focus});
    return '<div style="background:var(--s3);border:1px solid var(--b);border-radius:10px;padding:15px;width:100%;animation:fadeUp .3s ease both;"><div class="bbs" style="font-size:13px;letter-spacing:2px;color:var(--dr);margin-bottom:11px;">'+dl+'</div><div style="display:flex;flex-direction:column;gap:9px;">'+
    pts.map(function(p){return '<div><div class="msm" style="font-size:9px;letter-spacing:1.5px;color:'+p.color+';margin-bottom:3px;">'+p.icon+' '+p.label+'</div><div style="font-size:13px;color:var(--t2);line-height:1.6;white-space:pre-wrap;">'+esc(p.text)+'</div></div>';}).join('');
  }).join('');
}

// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(s){if(!s)return '';return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function boom(t){
  if(t==='small'){confetti({particleCount:40,spread:50,origin:{y:.7},colors:['#e8ff47','#fff','#3b82f6'],scalar:.8});}
  if(t==='medium'){confetti({particleCount:70,spread:65,origin:{y:.6},colors:['#e8ff47','#f97316','#10b981']});}
  if(t==='big'){confetti({particleCount:120,spread:80,origin:{y:.55},colors:['#e8ff47','#f97316','#10b981']});setTimeout(function(){confetti({particleCount:80,spread:110,origin:{y:.45},colors:['#3b82f6','#a855f7','#fff']});},250);}
  if(t==='mega'){var end=Date.now()+4500;var c=['#e8ff47','#fff','#f97316','#10b981','#3b82f6','#a855f7'];(function f(){confetti({particleCount:6,angle:60,spread:80,origin:{x:0},colors:c});confetti({particleCount:6,angle:120,spread:80,origin:{x:1},colors:c});if(Date.now()<end)requestAnimationFrame(f);})();}
}
function toast(msg,sub,color,icon){
  var c=document.getElementById('toasts'),el=document.createElement('div');
  el.style.cssText='pointer-events:auto;background:var(--s);border:1px solid '+color+'33;border-left:3px solid '+color+';border-radius:10px;padding:11px 13px;max-width:300px;animation:slideInR .4s cubic-bezier(.34,1.56,.64,1) both;cursor:pointer;';
  el.innerHTML='<div style="display:flex;align-items:center;gap:9px;"><span style="font-size:20px;flex-shrink:0;">'+icon+'</span><div><div class="bbs" style="font-size:16px;letter-spacing:1.5px;color:'+color+';line-height:1.1;">'+msg+'</div><div class="msm" style="color:var(--dim);margin-top:2px;font-size:9px;">'+sub+'</div></div></div>';
  el.onclick=function(){dis(el);};c.appendChild(el);setTimeout(function(){dis(el);},3200);
}
function dis(el){el.style.animation='slideOutR .4s ease both';setTimeout(function(){if(el.parentNode)el.parentNode.removeChild(el);},400);}
function confirmReset(){document.getElementById('mReset').style.display='flex';}
function closeReset(){document.getElementById('mReset').style.display='none';}
function doReset(){ST.methods=defMeth();svState();prevTot=0;closeReset();render();}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
applyTheme(isDark);
ldTodayDeb();
fillStageSelects();
rPipeline();
render();
</script>
</body>
</html>
